<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Administration Newsletter VISA-ISA</title>
  </head>
  <body
    style="
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #c8cacd;
      color: black;
      line-height: 1.4;
      min-height: 100vh;
    "
  >
    <div style="max-width: 1400px; margin: 0 auto">
      <!-- Header -->
      <div
        style="
          background: white;
          border: 2px solid #231f20;
          padding: 20px;
          margin-bottom: 20px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        "
      >
        <div>
          <div
            style="
              font-family: Arial, sans-serif;
              font-size: 2em;
              font-weight: bold;
              color: #d2232a;
              text-transform: uppercase;
            "
          >
            VISA-ISA
          </div>
          <div
            style="color: #605e5f; font-size: 1em; text-transform: uppercase"
          >
            Administration Newsletter
          </div>
        </div>
        <div>
          <a
            href="/newsletter/admin/login"
            style="
              padding: 10px 20px;
              background: #605e5f;
              color: white;
              border: 2px solid #231f20;
              text-decoration: none;
              font-weight: bold;
              text-transform: uppercase;
            "
          >
            Déconnexion
          </a>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 350px; gap: 20px">
        <!-- Tableau principal -->
        <div>
          <!-- Messages de succès/erreur -->
          <% if (success === 'unsubscribed') { %>
          <div
            style="
              padding: 15px;
              margin-bottom: 20px;
              background: #d4edda;
              color: #155724;
              border: 2px solid #c3e6cb;
            "
          >
            ✅ Email <strong><%= email %></strong> désinscrit avec succès
          </div>
          <% } %> <% if (error) { %>
          <div
            style="
              padding: 15px;
              margin-bottom: 20px;
              background: #f8d7da;
              color: #721c24;
              border: 2px solid #f5c6cb;
            "
          >
            ❌ Erreur : <%= error %>
          </div>
          <% } %>

          <!-- Tableau des subscribers -->
          <div
            style="background: white; border: 2px solid #231f20; padding: 20px"
          >
            <h2
              style="
                margin-top: 0;
                font-family: Arial, sans-serif;
                font-weight: bold;
                text-transform: uppercase;
                font-size: 1.5em;
              "
            >
              Liste des inscrits (<%= subscribers.length %>)
            </h2>

            <div style="overflow-x: auto">
              <table
                style="width: 100%; border-collapse: collapse; margin-top: 15px"
              >
                <thead>
                  <tr style="background: #605e5f; color: white">
                    <th
                      style="
                        padding: 12px;
                        text-align: left;
                        border: 2px solid #231f20;
                        font-weight: bold;
                        text-transform: uppercase;
                      "
                    >
                      Email
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: center;
                        border: 2px solid #231f20;
                        font-weight: bold;
                        text-transform: uppercase;
                      "
                    >
                      Statut
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: center;
                        border: 2px solid #231f20;
                        font-weight: bold;
                        text-transform: uppercase;
                      "
                    >
                      Date
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: center;
                        border: 2px solid #231f20;
                        font-weight: bold;
                        text-transform: uppercase;
                      "
                    >
                      Action
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <% subscribers.forEach(function(subscriber) { %>
                  <tr style="border-bottom: 1px solid #605e5f">
                    <td
                      style="
                        padding: 12px;
                        border: 1px solid #605e5f;
                        font-weight: bold;
                        color: #d2232a;
                      "
                    >
                      <%= subscriber.email %>
                    </td>
                    <td
                      style="
                        padding: 12px;
                        border: 1px solid #605e5f;
                        text-align: center;
                      "
                    >
                      <% if (subscriber.disabled) { %>
                      <span
                        style="
                          padding: 4px 8px;
                          background: #f8d7da;
                          color: #721c24;
                          border: 1px solid #f5c6cb;
                          font-size: 0.9em;
                        "
                      >
                        Désinscrit
                      </span>
                      <% } else if (subscriber.confirm) { %>
                      <span
                        style="
                          padding: 4px 8px;
                          background: #d4edda;
                          color: #155724;
                          border: 1px solid #c3e6cb;
                          font-size: 0.9em;
                        "
                      >
                        Confirmé
                      </span>
                      <% } else { %>
                      <span
                        style="
                          padding: 4px 8px;
                          background: #fff3cd;
                          color: #856404;
                          border: 1px solid #ffeaa7;
                          font-size: 0.9em;
                        "
                      >
                        En attente
                      </span>
                      <% } %>
                    </td>
                    <td
                      style="
                        padding: 12px;
                        border: 1px solid #605e5f;
                        text-align: center;
                        font-size: 0.9em;
                        color: #605e5f;
                      "
                    >
                      <%= new
                      Date(subscriber.createdAt).toLocaleDateString('fr-FR') %>
                    </td>
                    <td
                      style="
                        padding: 12px;
                        border: 1px solid #605e5f;
                        text-align: center;
                      "
                    >
                      <% if (!subscriber.disabled) { %>
                      <form
                        method="POST"
                        action="/newsletter/admin?token=<%= token %>"
                        style="display: inline"
                        onsubmit="return confirm('Êtes-vous sûr de vouloir désinscrire <%= subscriber.email %> ?');"
                      >
                        <input
                          type="hidden"
                          name="action"
                          value="unsubscribe"
                        />
                        <input
                          type="hidden"
                          name="email"
                          value="<%= subscriber.email %>"
                        />
                        <button
                          type="submit"
                          style="
                            padding: 6px 12px;
                            background: #d2232a;
                            color: white;
                            border: 2px solid #231f20;
                            font-family: Arial, sans-serif;
                            font-size: 0.9em;
                            font-weight: bold;
                            text-transform: uppercase;
                            cursor: pointer;
                          "
                        >
                          Désinscrire
                        </button>
                      </form>
                      <% } else { %>
                      <span style="color: #605e5f; font-size: 0.9em">-</span>
                      <% } %>
                    </td>
                  </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Sidebar - Inscription en lot -->
        <div>
          <div
            style="
              background: white;
              border: 2px solid #231f20;
              padding: 20px;
              position: sticky;
              top: 20px;
            "
          >
            <h3
              style="
                margin-top: 0;
                font-family: Arial, sans-serif;
                font-weight: bold;
                text-transform: uppercase;
                font-size: 1.2em;
              "
            >
              Inscription en lot
            </h3>

            <% if (bulkSuccess) { %>
            <div
              style="
                padding: 10px;
                margin-bottom: 15px;
                background: #d4edda;
                color: #155724;
                border: 2px solid #c3e6cb;
                font-size: 0.9em;
              "
            >
              ✅ <%= bulkSuccess %> email(s) inscrit(s)
            </div>
            <% } %> <% if (bulkErrors) { %>
            <div
              style="
                padding: 10px;
                margin-bottom: 15px;
                background: #fff3cd;
                color: #856404;
                border: 2px solid #ffeaa7;
                font-size: 0.9em;
              "
            >
              ⚠️ <%= bulkErrors %> erreur(s)
            </div>
            <% } %>

            <form method="POST" action="/newsletter/admin?token=<%= token %>">
              <input type="hidden" name="action" value="bulk_subscribe" />
              <div style="margin-bottom: 15px">
                <label
                  for="emails"
                  style="
                    font-family: Arial, sans-serif;
                    font-size: 1em;
                    margin: 0;
                    padding: 0 0 0 5px;
                    display: block;
                    margin-bottom: 8px;
                    font-weight: bold;
                  "
                >
                  Emails (un par ligne)
                </label>
                <textarea
                  id="emails"
                  name="emails"
                  rows="8"
                  required
                  placeholder="contact@example.com&#10;user@domain.com"
                  style="
                    width: 100%;
                    padding: 10px;
                    border: 2px solid #231f20;
                    font-size: 14px;
                    font-family: Arial, sans-serif;
                    box-sizing: border-box;
                    resize: vertical;
                  "
                ></textarea>
              </div>

              <button
                type="submit"
                style="
                  width: 100%;
                  padding: 12px;
                  background: #d2232a;
                  color: white;
                  border: 2px solid #231f20;
                  font-family: Arial, sans-serif;
                  font-size: 1em;
                  font-weight: bold;
                  text-transform: uppercase;
                  cursor: pointer;
                "
                onmouseover="this.style.boxShadow='5px 5px 0 rgba(0,0,0,0.5)'"
                onmouseout="this.style.boxShadow='none'"
              >
                Inscrire en lot
              </button>
            </form>

            <div
              style="
                margin-top: 15px;
                padding-top: 15px;
                border-top: 1px solid #605e5f;
                font-size: 0.85em;
                color: #605e5f;
              "
            >
              <p style="margin: 5px 0">
                <strong>Format :</strong> Un email par ligne
              </p>
              <p style="margin: 5px 0">
                Les emails existants seront mis à jour.
              </p>
            </div>
          </div>

          <!-- Désinscription en lot -->
          <div
            style="
              background: white;
              border: 2px solid #231f20;
              padding: 20px;
              margin-top: 20px;
              position: sticky;
              top: 20px;
            "
          >
            <h3
              style="
                margin-top: 0;
                font-family: Arial, sans-serif;
                font-weight: bold;
                text-transform: uppercase;
                font-size: 1.2em;
              "
            >
              Désinscription en lot
            </h3>

            <% if (bulkUnsubSuccess) { %>
            <div
              style="
                padding: 10px;
                margin-bottom: 15px;
                background: #d4edda;
                color: #155724;
                border: 2px solid #c3e6cb;
                font-size: 0.9em;
              "
            >
              ✅ <%= bulkUnsubSuccess %> email(s) désinscrit(s)
            </div>
            <% } %> <% if (bulkUnsubErrors) { %>
            <div
              style="
                padding: 10px;
                margin-bottom: 15px;
                background: #fff3cd;
                color: #856404;
                border: 2px solid #ffeaa7;
                font-size: 0.9em;
              "
            >
              ⚠️ <%= bulkUnsubErrors %> erreur(s)
            </div>
            <% } %>

            <form
              method="POST"
              action="/newsletter/admin?token=<%= token %>"
              onsubmit="return confirm('Êtes-vous sûr de vouloir désinscrire ces emails ? Cette action est irréversible.');"
            >
              <input type="hidden" name="action" value="bulk_unsubscribe" />
              <div style="margin-bottom: 15px">
                <label
                  for="unsubscribe_emails"
                  style="
                    font-family: Arial, sans-serif;
                    font-size: 1em;
                    margin: 0;
                    padding: 0 0 0 5px;
                    display: block;
                    margin-bottom: 8px;
                    font-weight: bold;
                  "
                >
                  Emails à désinscrire (un par ligne)
                </label>
                <textarea
                  id="unsubscribe_emails"
                  name="emails"
                  rows="8"
                  required
                  placeholder="contact@example.com&#10;user@domain.com"
                  style="
                    width: 100%;
                    padding: 10px;
                    border: 2px solid #231f20;
                    font-size: 14px;
                    font-family: Arial, sans-serif;
                    box-sizing: border-box;
                    resize: vertical;
                  "
                ></textarea>
              </div>

              <button
                type="submit"
                style="
                  width: 100%;
                  padding: 12px;
                  background: #d2232a;
                  color: white;
                  border: 2px solid #231f20;
                  font-family: Arial, sans-serif;
                  font-size: 1em;
                  font-weight: bold;
                  text-transform: uppercase;
                  cursor: pointer;
                "
                onmouseover="this.style.boxShadow='5px 5px 0 rgba(0,0,0,0.5)'"
                onmouseout="this.style.boxShadow='none'"
              >
                Désinscrire en lot
              </button>
            </form>

            <div
              style="
                margin-top: 15px;
                padding-top: 15px;
                border-top: 1px solid #605e5f;
                font-size: 0.85em;
                color: #605e5f;
              "
            >
              <p style="margin: 5px 0">
                <strong>⚠️ Attention :</strong> Cette action est irréversible.
              </p>
              <p style="margin: 5px 0">
                <strong>Format :</strong> Un email par ligne
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
